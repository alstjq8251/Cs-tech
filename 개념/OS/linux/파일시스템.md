## 파일시스템
- 리눅스 리소스의 대부분은 실제로 파일이며 디바이스와 의사 디바이스 또한 리눅스에선 파일로 취급된다.
- 모든 것이 공통적으로 지니는 점은 파일 열기, 정보 수집, 파일 작성 등 표준화되고 통일하된 인터페이스다.
- 리눅스에선 파일시스템이 이런 통일된 인터페이스를 제공하고 리눅스가 파일을 바이트 스트림으로 취급하여 다양한 파일 유형을 지원하는 도구를 만들 수 있게 된다.

`개요`
- 예외가 있긴 하지만 대부분의 파일시스템은 계층 구조로 되어있고 사용자는 root(/)로 시작하는 단일 파일시스템 트리를 제공받게 된다.
- 파일시스템 트리엔 디렉토리와 파일이란 두 가지 유형의 객체가 있다. 
- 디렉토리의 내용을 나열(ls)하고 타 디렉토리로 변경(cd)하고 현재 작업 디렉토리를 출력(pwd)하는 등 파일시스템을 탐색할 수 있다.
- 파일시스템이 가지고 있는 속성 중 소유권이 있으며 권한이 내장되어 있고, 소유권은 할당된 권한을 통해 두 객체에 대한 접근을 제어한다.
- 파일시스템은 커널에서 구현된다.

#### 파일시스템을 이해하기 위한 용어
`드라이브`
- 하드 디스크 드라이브(HDD), 솔리드 스테이트 드라이브(SDD)와 같은 블록 디바이스다. 
- 가상 머신의 드라이브는 에뮬레이션될 수 있다.
  - /dev/sda(SCSI 디바이스), /dev/sdb(SATA 디바이스), /dev/hda(IDE 디바이스)

`파티션`
- 드라이브를 스토리지 섹터의 집합인 파티션으로 논리적으로 분할할 수 있다.
  - 예를 들어 HDD에 두개의 파티션을 생성하면 /dev/sdb1 와 /dev/sdb2로 표시되는 식

`볼륨`
- 파티션과 비슷하지만 더 유연하며 특정 파일시스템용으로 포맷되기도 한다.

`슈퍼 블록`
- 시스템이 포맷되면 파일시스템의 시작 부분에 메타데이터를 캡쳐하는 특수 섹션이 생긴다.
  - 파일시스템의 유형, 블록, 상태, 블록당 아이노드 수 등이 담긴다.

`아이노드`
- 크기, 소유자, 날짜, 권한과 같은 메타데이터를 저장하지만 파일명과 실제 데이터는 저장하지 않는다.
  - 위 데이터는 디렉토리에 보관되며 디렉토리는 아이노드를 파일명에 매핑하는 특별한 종류의 일반 파일이라 할 수 있다.

<details>
<summary><strong>용어별 확인하는 방법</strong></summary>
<div>

- 논리 디바이스에 대한 설정을 확인

```shell
lsblk --exclude 7 # 의사(루프) 디바이스를 제외한 모든 블록 디바이스를 나열한다.
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0   1.8T  0 disk # 전체적으로 1.8T의 용량을 가진 sda라는 디스크 드라이브가 있다.
└─sda1   8:1    0   1.8T  0 part #
sdb      8:16   1   930G  0 disk # 전체적으로 0.9T의 용량을 가진 sda라는 디스크 드라이브가 있다.
├─sdb1   8:17   1   976M  0 part /boot # 다섯개의 파티션이 존재하며 sdb1은 부팅 파티션이다.
├─sdb2   8:18   1   7.6G  0 part
├─sdb3   8:19   1   7.6G  0 part /tmp
├─sdb4   8:20   1     1K  0 part
└─sdb5   8:21   1 913.8G  0 part /
```

- 사용 중인 파일시스템을 확인 

```shell
findmnt -D -t nosquashfs # 파일시스템을 나열하지만 스쿼시FS(CD용으로 특수 읽기 전용 압축 시스템) 유형은 제외한다.
SOURCE               FSTYPE     SIZE   USED  AVAIL USE% TARGET
devtmpfs             devtmpfs  31.4G      0  31.4G   0% /dev
tmpfs                tmpfs     31.5G      0  31.5G   0% /dev/shm
tmpfs                tmpfs     31.5G   3.2G  28.3G  10% /run
tmpfs                tmpfs     31.5G      0  31.5G   0% /sys/fs/cgroup
/dev/sdb5            ext4     899.3G   332G 521.7G  37% /
/dev/sdb1            ext4     944.7M   187M 692.9M  20% /boot
/dev/sdb3            ext4       7.4G 180.3M   6.8G   2% /tmp
```

```shell
stat myfile
  File: myfile
  Size: 4096      	Blocks: 8          IO Block: 4096   디렉토리 # 파일 유형 정보
Device: 815h/2069d	Inode: 36306979    Links: 2 # 디바이스와 아이노드 정보
Access: (0744/drwxr--r--)  Uid: ( 1005/   test)   Gid: ( 1005/   test)
Access: 2024-10-10 02:45:11.043450892 +0900
Modify: 2023-08-10 13:48:44.359250188 +0900
Change: 2023-08-10 13:48:44.359250188 +0900
 Birth: -
```

|      명령어       |     사용 예제     |
|:--------------:|:-------------:|
| lsblk | 모든 블록 디바이스 나열  |
| fdisk, parted | 디스크 파티션 관리 |
| blkid | UUID와 같은 블록 디바이스 속성 표시 |
| hwinfo | 하드웨어 정보 표시 |
| file -s | 파일시스템과 파티션 정보 표시 |
| stat, df -i, ls -i | 아이노드와 관련된 정보 표시 및 목록 출력 |

</div>
</details>

`링크`
- 다른 이름의 파일을 참조하거나 단축어를 제공하고 싶을때 리눅스에선 두 가지 유형의 링크를 제공한다.

`하드 링크`
- 아이노드를 참조하며 디렉토리는 참조할 수 없고 파일시스템이 다르면 동작하지 않는다.
`심볼릭 링크(symbolic) 또는 Symlink`
- 파일의 내용이 다른 파일의 경로를 나타내는 문자열인 특수 파일

<details>
<summary><strong>실제 링크 예시</strong></summary>
<div>

```shell
ln myfile somealias # 하드 링크 생성
ln -s myfile somesoftalias # 심볼릭 링크 생성(-s옵션)
ls -al *alias # 파일 목록 출력 파일 유형의 차이와 이름 표시 방식을 보자, ls -ali *alis를 사용하면 두 아이노드가 동일하다는 것을 알 수 있다.
stat somealias # 하드링크의 파일 내역 표시
stat somesoftalias # 심볼릭링크의 파일 내역 표시
```

</div>
</details>

### 가상 파일시스템
- 리눅스는 가상 파일 시스템(VFS)이란 추상화를 통해 다양한 조율의 리소스(인메모리,로컬 연결, 네트워크 스토리지)에 파일과 유사한 접근을 제시할 수 있다.
- 기본 개념은 클라이언트(시스템 콜)와 개별 파일 시스템 간 간접 계층을 두는 것 이다.
- 대표적으로 OOP 개념이 적용된 서브시스템이다

`struct super_block`

### VFS의 의의