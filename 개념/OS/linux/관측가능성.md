## 관측가능성

### 관측 가능성 전략

- 널리 확립된 전략 중 하나는 우다(OODA) 루프 다. (관찰(observe) - 방향 설정(orient) - 결정(decide) - 실행(act))
  - 이는 관측된 데이터를 기반으로 가설을 테스트하고 이에 따라 조치를 취하는 구조화된 방법, 시그널로부터 실행 가능한 통찰력을 얻는 방법을 제공한다.
 
#### 관측 가능성 용어

`관측 가능성`
- 외부 정보를 측정해 시스템(리눅스 등)의 내부 상태를 평가하는 것. 일반적으론 후속 조치를 취한다.

`시그널 유형`
- 기호적 수단(페이로드, 로그는 텍스트다)이나 숫자 값(측정 지표 등), 또는 이들의 조합을 통해 시스템 상태에 대한 정보를 보여주고 내보내는 다양한 방식을 말한다.

`소스`
- 시그널을 생성하는 곳, 해당 시그널의 유형은 다양할 수 있다. (소스는 리눅스 운영체제일 수 도, 애플리케이션일 수 도 있다.)

`목적지`
- 시그널을 소비, 저장, 추가적으로 처리하는 곳이다.
- 사용자 인터페이스(GUI, TUI, CLI)를 노출하는 목적지를 **프론트엔드**라고 한다.

`텔레메트리`
- 소스에서 시그널을 추출하고 먹적지로 전송(또는 라우팅, 배송)하는 프로세스로, 시그널을 수집 및 전처리(필터, 다운샘플링)하는 에이전트를 사용하는 경우가 많다.

### 시그널 유형

- **시그널**은 추가 처리나 해석을 위해 시스템 상태를 전달하는 방법으로서, 크게 텍스트 페이르도와, 숫자 페이로드로 구분한다.
- 일반적인 시그널 유형은 세 가지로, 로그, 지표, 추적이다.

#### 로그(log)

- 로그란 사람이 사용할 수 있는 텍스트 페이로드가 있는 개별 이벤트로서 일반적으론 타임스탬프가 지정되고 거의 모든 시스템이 생성하는 유형이다.
- 모든 로그가 일종의 구조를 지님에도 실무에선 **구조화된 로깅**이란 용어를 쓰게 되는데 이는 로그가 JSON을 이용해 구성된다는 의미다.
- 로그 항목의 중요성이나 의도된 대상 소비자를 알려주기 위해 대부분의 로그는 레벨을 정의해 둔다.
- 구조적 관점에서 전체적으로 로그는 하단과 같이 구성된다.
  - `로그 항목, 메시지, 행의 모음`
    - 개별 이벤트에 대한 정보 캡처
  - `메타데이터, 컨텍스트`
    - 전역 범위 뿐만 아니라 메시지 단위로 존재할 수도 있다.
  - `개별 로그 메시지를 해석하는 방법을 보여주는 형식`
    - 로그의 부분과 의미를 정의한다.

`syslog`
- 커널에서부터 데몬, 사용자 공간까지 이르는 다양한 소스의 로깅 표준
- 네트워크 환경에 근간을 두고 있으며 최근의 프로토콜은 배포 시나리오 및 보안 고려사항과 함께 RFC5424에 정의된 텍스트 형식으로 구성된다.
- syslog의 헤더
  - `PRI`
    - 메시지의 장비 유형과 ㅅ미각도
  - `VER`
    - Syslog 프로토콜 번호(1만 가능하므로 보통은 생략)
  - `TS`
    - ISO 8601 형식을 사용해 메시지가 생성된 시각을 표시
  - `HN`
    - 메시지를 보낸 시스템을 식별
  - `APP`
    - 메시지를 보낸 애플리케이션을 식별
  - `PID`
    - 메시지를 보낸 프로세스를 식별
  - `MID`
    - 메시지 ID
- 일반적으로 로그 관리엔 syslogd 바이너리를 사용하는데 시간이 지나며 하단의 도구도 사용이 가능해졌다.
  - `syslog-ng`
    - syslogd의 드롭인 교체로 사용할 수 있으며 TLS, 콘텐츠 기반 필터링 , db 로그인을 추가로 지원하는 향상된 로그 데몬이다.
  - `rsyslog`
    - syslog 프로토콜을 확장한 것이며 systemd와 함께 사용 가능

`journalctl`
- journalctl은 바이너리 형식을 사용해 로그 항목을 저장해 더 빠르게 접근할 수 있으며 저장 공간도 더 확보할 수 있다.

#### 지표(metric)

- **지표(metric)**는 (대부분 정기적으로) 샘플링된 숫자 데이터 포인터로서, 시계열을 형성한다.
- 각각의 데이터 포인터는 차원이나 식별 메타데이터의 형태로 추가 컨텍스트를 가질 수 있다.
- 일반적으로 원시(raw) 지표를 사용하지 않고 일종의 집계(Aggregation)나 그래픽 표현을 사용하고 특정 조건이 충족되면 알림을 받기도 한다.
- 지표는 하단과 같은 유형으로 분류할 수 있다.
  - `카운터`
    - 카운터 값은 올라갈 수만 있다.(0으로 설정하는 경우 제외) 예론 서비스에서 처리한 총 요청 수, 일정 기간 전송된 바이트가 될 수 있다.
  - `게이지`
    - 게이지 값은 올라가거나 내려갈 수 있다. 예로 현재 사용 가능한 전체 메인 메모리나 실행 중인 프로세스 수를 게이지로 볼 수 있다.
  - `히스토그램`
    - 값의 분포를 보여주는 정교한 방법이다. 버킷을 사용하면 히스토그램을 통해 전체 데이터가 어떻게 구성되어 있는지를 평가할 수 있다.

#### 추적(trace)

- **추적**은 런타임 정보의 동적 모음으로서 디버깅뿐만 아니라 성능 평가에도 자주 사용된다.

#### 모니터링

- 다양한 이유로 시스템과 애플리케이션 지표를 캡처하는 것을 의미한다.
