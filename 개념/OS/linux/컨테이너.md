## 컨테이너

- 컨테이너를 리눅스 네임스페이스, cgroup, 때로 CoW 파일시스템을 사용해 어플리케이션 수준의 종속성 관리를 제공하는 리눅스 프로세스 그룹으로 이해한다.
- 리눅스에서 컨테이너는 새로운 개념은 아니지만 도커 덕분에 2014년부터 주류로 편입되었는데 그전까지 컨테이너를 도입하려던 사례는 하단과 같다.
  - 리눅스 V서버(Linux-VServer)
  - 오픈VZ(OpenVZ)
  - LXC(2008)
  - lmctfy(Let Me Contain That for You)

> 모든 접근 방식의 공통점은 네임스페이스, cgroup같이 리눅스 커널이 제공하는 기본 빌딩 블록을 사용해 사용자가 app을 실행할 수 있게 하는 것이다.

- 도커는 기존 개념을 혁신하고 2가지 획기적인 요소를 도입했다.
    1. 컨테이너 이미지를 통해 패키징을 정의하는 표준적인 방법(Open Container Initiative OCI)
    2. 인간 친화적인 사용자 인터페이스(cli ex: docker run)
- 도커에서 컨테이너 이미지가 정의되고 배포되는 방식과 컨테이너가 실행되는 방식은 현재 OCI 핵심 사양의 기반이 됐다.
- 3가지 핵심 OCI 컨테이너 사양은 하단과 같다.
    1. 런타임 사양
       - 운영과 수명주기 단계를 포함해 런타임이 지원해야 하는 것을 정의한다.
    2. 이미지 형식 사양 
       - 메타데이터와 계층을 기반으로 컨테이너 이미지가 구성되는 방식을 정의한다.
    3. 배포 사양
       - 컨테이너 이미지가 전달되는 방식, 컨테이너와 관련해 저장소가 효과적으로 동작할 수 있는 방식을 정의

- 컨테이너와 관련된 또 다른 개념은 불변성(imutability)인데 한 번 구성 시 런타임간 변경할 수 없다는 의미다.
  - 변경하기 위해선 새로운(정적) 구성과 새 리소스(프로세스)를 생성해야 한다.

### 리눅스 네임 스페이스

- 초기 리눅스는 리소스에 대해 전역 뷰를 가지고 있었는데 프로세스가 리소스(파일시스템, 네트워킹, 사용자)에 대한 로컬 뷰를 가질 수 있도록 네임스페이스를 도입했다.
- 리눅스 네임스페이스는 리소스 가시성에 관한 것이며 운영체제 리소스의 다양한 측면을 격리하는데 사용할 수 있다.
- 네임스페이스 관점에서의 격리란 프로세스가 무엇을 보는지와 관련이 있으며 보안에서의 엄격한 경계는 아니다.
- 네임스페이스르 생성하려면 3가지 관련 시스템 콜을 원하는 대로 상황에 맞게 사용할 수 있다.
    1. clone
        - 실행 컨텍스트의 일부를 부모 프로세스와 공유할 수 있는 자식 프로세스를 만드는 데 사용된다.
    2. unshare
        - 기존 프로세스에서 공유된 실행 컨텍스트를 제거하는 데 사용된다.
    3. setns
        - 기존 프로세스를 기존 네임스페이스에 결합하는데 사용된다.