## DNS

`개요`
- 식별하는 것이 주 기능인 `IP주소`는 TCP/IP 스택의 인터넷 계층이 정의하는데 이런 숫자로 된 IPv4, IPv6는 두 가지 문제가 존재한다.

1. 인간은 숫자보다 이름을 더 잘 기억한다.
2. 인터넷과 애플리케이션이 만들어진 방식으로 인해 IP 주소는 자주 변경된다.
    - 전통적 설정에선 새 IP의 새 서버가 생길 수 있고 언제든 IP가 새로이 생기거나 변경될 수 있으며 컨테이너의 경우 호스트가 변경되거나 DHCP처럼 자동으로 새 IP가 할당된다.

- IP 주소는 기억하기 어렵고 바뀔 수 있지만 이름(서비스)은 동일하게 유지되는데 이 문젠 인터넷이 시작하고 유닉스가 TCP/IP를 지원한 이후부터 존재해왔다.

### DNS의 의미

- DNS란 인터넷의 호스트와 서비스 모두를 위해 전 세계에서 사용하는 계층적인 명명 시스템이다.

### DNS의 주요 개념

`도메인 네임 스페이스(domain name space)`
- .(마침표)가 루트인 트리 구조로, 각 트리 노드와 리프엔 특정 공간에 대한 정보가 포함돼 있다.
- 리프에서 루트까지의 경로인 레이블(최대 길이 63바이트)을 **정규화된 도메인 네임(FQDN)**이라고 한다.
  - 예로 demo.mhausenblas.info.는 최상위 도메인이 .info인 FQDN이며 루트를 뜻하는 맨 오른쪽 마침표는 대부분 생략된다.

`리소스 레코드(resource record)`
- 도메인 네임 스페이스의 노드나 리프에 있는 페이로드

`네임 서버(name server)`
- 도메인 트리 구조에 대한 정보를 가지고 있는 서버 프로그램
- 네임 서버가 네임 스페이스에 대한 완전한 정보를 가지고 있는 경우 **권위 있는(authoritative)네임 서버**라고 한다. 
  - 권위 있는 정보는 존 으로 구성된다.

`리졸버(resolver)`
- 클라이언트 요청에 대한 응답으로 네임 서버에서 정보를 추출하는 프로그램
- 로컬에 있는 시스템이며, 리졸버와 클라이언트 간의 상호 작용을 위해 정의된 명시적인 프로토콜은 없다.
- 대다수 시스템은 DNS 질의를 처리하기 위한 라이브러리 호출을 지원한다.

- DNS는 계층 네이밍 시스템이며 루트엔 최상위 도메인 레코드를 관리하는 13개의 루트서버가 있다.
- 루트 바로 아래엔 최상위 도메인(top-level domain TLD)이 있다.

`인프라 최상위 도메인`
- IANA가 IETF를 대신해 관리하며 example과 localhost 등을 포함한다.

`일반 최상위 도메인(gTLD)`
- .org나 .com처럼 3개 이상의 문자가 포함된 일반(generic) 도메인

`국가 코드 최상위 도메인(ccTLD)`
- 두 글자로 된 ISO 국가 코드가 할당된 국가나 지역을 위한 도메인

`스폰서 최상위 도메인(sTLD)`
- .aero나 .gov같이 TLD를 사용할 수 있는 자격을 제한하는 규칙을 세우고 시행하는 민간 기관이나 조직을 위한 도메인

### DNS 레코드

- 네임서버는 유형이나 페이로드를 비롯해 그 밖의 필드를 캡처하는 레코드를 관리한다.
  - 여기엔 생존시간(TTL) 레코드가 폐기될 시점을 정하는 기한 등도 포함된다.
- FQDN을 노드의 주소로, 리소스 레코드(RR)를 노드의 데이터인 페이로드로 생각할 수 있다.

DNS엔 다양한 레코드 유형이 있으며 그 중 중요한 유형은 하단과 같다.

`A레코드와 AAAA레코드(RFC 3596)`
- 각각 IPv4, IPv6 주소 레코드다. 일반적으로 호스트 이름을 호스트의 IP 주소에 매핑하는 데 사용된다.

`CNAME 레코드(RFC 1035)`
- 한 이름의 엘리어스를 다른 이름에 제공하는 캐노니컬 네임(canonical name) 레코드

`NS 레코드(RFC 1035)`
- 권위 있는 네임 서버를 사용하도록 DNS 존을 위임하는 네임 서버 레코드

`PTR 레코드(RFC 1035)`
- 역방향 DNS 조회를 수행하는 데 사용되는 포인터 레코드다. A 레코드의 반대

`SRV 레코드(RFC 2782)`
- 서비스 로케이터 레코드, 하드코딩된 것이라기 보다 일반적인 탐색 매커니즘이라 할 수 있다.(예전 메일 교환을 위해 사용했던 MX 레코드의 경우와 같다.)

`TXT 레코드(RFC 1035)`
- 텍스트 레코드, 원랜 사람이 읽을 수 있는 임의의 텍스트 용도였지만 시간이 지나 새로운 용례가 발견됐다.
  - 최근 이 레코드엔 보안 관련 DNS 확장의 맥락에서 기계가 판독할 수 있는 데이터가 있는 경우가 많다.

> 또한 존재하지 않는 이름에 대한 요청에도 모두 매칭하기 위해 별 레이블(*)로 시작하는 와일드카드 레코드도 있다.

- DNS 레코드는 바인드와 같은 네임 서버가 읽고 데이터베이스의 일부로 생성하는 존 파일에 텍스트 형식으로 표시된다.

<details>
<summary><strong>DNS 조회</strong></summary>
<div>

```shell

$ host -a localhost # 로컬 IP 주소를 조회한다.

$ host mhausenblas.info # FQDN을 조회한다.

$ host 185.199.110.153 # FQDN을 찾기 위해 IP 주소 역방향 조회를 한다.

### DNS 레코드를 조회하는 더 강력한 방법은 dig 명령을 사용하는 것

$ dig mhausenblas.info

```

</div>
</details>